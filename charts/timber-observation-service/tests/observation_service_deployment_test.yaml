suite: Unit tests for Observation Service Deployment
templates:
  - deployment.yaml
release:
  name: my-release
  namespace: my-namespace
  revision: 1
  isUpgrade: true
tests:
  - it: should set Fluentd GCP secret if Fluentd is configured for BQ sink writing
    set:
      global: {}
      fluentd:
        enabled: true
        gcpServiceAccount:
          credentialsData: "dummy"
      timber-fluentd:
        fullname: a
    asserts:
      - isKind:
          of: Deployment
      - matchRegex:
          path: metadata.name
          pattern: my-release-timber-observation-service
      - contains: # check GCP service account volume
          path: spec.template.spec.volumes
          content:
           name: gcp-service-account
           secret:
            secretName:  my-release-timber-observation-service-fluentd
      - contains: # check env var added
          path: spec.template.spec.containers[0].env
          content:
            name: GOOGLE_APPLICATION_CREDENTIALS
            value: /etc/gcp_service_account/service-account.json
