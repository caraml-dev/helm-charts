suite: Unit tests for Observation Service Fluentd HPA
templates:
  - fluentd-hpa.yaml
release:
  name: my-release
  namespace: my-namespace
  revision: 1
  isUpgrade: true
tests:
  - it: should set specified targetCPUUtilizationPercentage
    set:
      global: {}
      fluentd:
        autoscaling:
          enabled: true
          targetCPUUtilizationPercentage: 90
    asserts:
      - isKind:
          of: HorizontalPodAutoscaler
      - matchRegex:
          path: metadata.name
          pattern: my-release-observation-service-fluentd$
      - equal: # check targetCPUUtilizationPercentage
          path: spec.targetCPUUtilizationPercentage
          value: 90
